var J=Object.defineProperty;var K=(e,s,o)=>s in e?J(e,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[s]=o;var E=(e,s,o)=>(K(e,typeof s!="symbol"?s+"":s,o),o);import{r as a,u as X,C as $,b as I,B as ee,f as L,M as te,V as P,Q as se,h as S,a as _,j as n,i as oe,c as ne,T,E as re,k as ae}from"./index-8f6c4088.js";import{E as ie,D as ce,B as le,N as ue,V as me}from"./index-eabbcb93.js";const he=e=>(e%T+T)%T;class U extends oe{constructor(o,i,c,l=0){super();E(this,"helixLength");E(this,"helixRadius");E(this,"helixWindingSeparation");E(this,"helixStartingAngleRad");this.helixLength=o,this.helixRadius=i,this.helixWindingSeparation=c,this.helixStartingAngleRad=he(l)}getPoint(o,i=new P){o-=.5;const l=1/(this.helixLength/this.helixWindingSeparation),t=T*(o%l/l),p=this.helixRadius*Math.cos(t+this.helixStartingAngleRad),u=this.helixRadius*Math.sin(t+this.helixStartingAngleRad),M=this.helixLength*o;return i.set(p,u,M)}}const xe=(e,s)=>Math.hypot(e*Math.sin(s),e*Math.cos(s)-e),F=a.forwardRef(({coordinateMapper:e,helixLength:s=10,helixWindingSeparation:o=10,helixRadius:i=1,strandRadius:c=.1,baseSpacing:l=.35,strandOffsetRad:t=Math.PI/2,mirrorEffects:p=!0,fixedBaseGap:u=!0,...M},w)=>{const{palette:C}=X(),g=$.getPalette(C).buildLut(),B=Math.floor(s/l),h=a.useRef(null),G=a.useMemo(()=>new I({color:"#606060"}),[g]),O=a.useMemo(()=>{const r=.45*xe(i,t),d=new ee(c,c,r,1);for(let x=0;x<d.attributes.position.count;x++)d.attributes.position.setZ(x,d.attributes.position.getZ(x)-r/2);return d.attributes.position.needsUpdate=!0,d},[i,c,t]),Q=a.useRef(null),Z=a.useRef(null),H=a.useMemo(()=>new I({color:g.getColor(.5)}),[g]),[D,Y,k,q]=a.useMemo(()=>{const f=new U(s,i,o,0),r=new U(s,i,o,t);return[f,new L(f,100,c,12,!1),r,new L(r,100,c,12,!1)]},[s,i,o,c,t]),m=a.useMemo(()=>new te,[]),j=a.useMemo(()=>new P,[]),b=a.useMemo(()=>new P,[]),y=a.useMemo(()=>new P,[]),R=a.useMemo(()=>new se,[]),z=a.useMemo(()=>new P(0,0,1),[]);return a.useEffect(()=>{let f=0;for(let r=0;r<B;r++){f=r/Math.max(B-1,1);const d=Math.floor(3.99*S.seededRandom(r)),x=3-d;D.getPoint(f,j),k.getPoint(f,b),m.setPosition(j),m.lookAt(j,b,z),h.current.setMatrixAt(r*2,m),h.current.setColorAt(r*2,g.getColor(d/3)),m.setPosition(b),m.lookAt(b,j,z),h.current.setMatrixAt(r*2+1,m),h.current.setColorAt(r*2+1,g.getColor(x/3))}h.current.instanceMatrix.needsUpdate=!0,h.current.instanceColor.needsUpdate=!0},[D,k,h,B,g]),_(({clock:f})=>{const r=f.getElapsedTime();let d=0,x=0,v=0,N=0;const V=.25,W=1;for(let A=0;A<B;A++)d=A/Math.max(B-1,1),x=e.map(ne.CARTESIAN_1D,p?2*Math.abs(d-.5):d,0,0,r)/e.amplitude,x=(1+x)/2,v=V+(u?2*x:x)*(W-V),N=u?V+2*(1-x)*(W-V):v,h.current.getMatrixAt(A*2,m),m.decompose(j,R,y),y.z=v,m.compose(j,R,y),h.current.setMatrixAt(A*2,m),h.current.getMatrixAt(A*2+1,m),m.decompose(b,R,y),y.z=N,m.compose(b,R,y),h.current.setMatrixAt(A*2+1,m);h.current.instanceMatrix.needsUpdate=!0}),n.jsxs("group",{...M,ref:w,children:[n.jsx("mesh",{ref:Q,geometry:Y,material:H,castShadow:!0,receiveShadow:!0}),n.jsx("mesh",{ref:Z,geometry:q,material:H,castShadow:!0,receiveShadow:!0}),n.jsx("instancedMesh",{ref:h,args:[O,G,2*B],castShadow:!0,receiveShadow:!0})]})}),ge=e=>{const i=Array.from({length:5}).map(()=>a.useRef(null)),c=Array.from({length:5}).map((l,t)=>new P().fromArray(Array.from({length:3}).map((p,u)=>2*S.seededRandom(t+u)-1)).normalize().multiplyScalar(15));return _(({clock:l})=>{const t=l.getElapsedTime(),p=5e-4,u=.05;let M,w=0;i.forEach((C,g)=>{C.current&&(M=c[g],w=Math.sin(u*(.5+.5*S.seededRandom(g))*t+S.seededRandom(g)/u),C.current.position.set(M.x*w,M.y*w,M.z*w),C.current.rotation.z+=p*Math.cos((.5+.5*S.seededRandom(g))*t),C.current.rotation.y+=p*Math.cos((.5+.5*S.seededRandom(g))*t))})}),n.jsx(n.Fragment,{children:i.map((l,t)=>n.jsx(F,{ref:l,position:c[t],rotation:new re(...Array.from({length:3}).map((p,u)=>Math.PI*(2*S.seededRandom(t+u)-1))),...e},t))})},de=({coordinateMapper:e})=>{const{multi:s,helixLength:o,helixRadius:i,helixWindingSeparation:c,strandRadius:l,baseSpacing:t,strandOffsetRad:p,mirrorEffects:u,fixedBaseGap:M}=ae();return s?n.jsx(ge,{coordinateMapper:e,helixLength:o,helixRadius:i,helixWindingSeparation:c,strandRadius:l,baseSpacing:t,strandOffsetRad:p,mirrorEffects:u,fixedBaseGap:M}):n.jsx(F,{coordinateMapper:e,helixLength:o,helixRadius:i,helixWindingSeparation:c,strandRadius:l,baseSpacing:t,strandOffsetRad:p,mirrorEffects:u,fixedBaseGap:M})},Ae=({...e})=>n.jsxs(n.Fragment,{children:[n.jsx(de,{...e}),n.jsxs(ie,{children:[n.jsx(ce,{focusDistance:0,focalLength:.02,bokehScale:3,height:480}),n.jsx(le,{luminanceThreshold:0,luminanceSmoothing:.9,height:300}),n.jsx(ue,{opacity:.02}),n.jsx(me,{eskil:!1,offset:.1,darkness:1.1})]})]});export{Ae as default};
